<!-- Barra de Ferramentas com pesquisa e bot√£o de adicionar produto -->
<app-toolbar
  (toggleSearchEvent)="onToggleSearch()"
  (openAddDialogEvent)="openAddDialog()">
</app-toolbar>

<!-- Se√ß√£o de Filtros Din√¢micos -->
<div *ngIf="showSearchBar" class="search-container">
  <h3>Filtros de Pesquisa</h3>

  <!-- Filtro Din√¢mico: Para cada filtro din√¢mico adicionado -->
  <div *ngFor="let filter of filters; let i = index" class="filter-group">
    <!-- Selecionar o campo para buscar -->
    <label for="searchField-{{i}}">Buscar por:</label>
    <select [formControl]="filter.searchField" class="search-select">
      <option value="productName">Nome</option>
      <option value="numberLote">N√∫mero do Lote</option>
      <option value="productType">Tipo</option>
      <option value="dateExpiration">Data de Validade</option>
      <option value="priceForUnity">Pre√ßo Unit√°rio</option>
      <option value="priceForUnityPercent">Pre√ßo Unit√°rio com Ganho</option>
      <option value="priceForLote">Pre√ßo por Lote</option>
      <option value="priceForLotePercent">Pre√ßo por Lote com Ganho</option>
      <option value="gainPercentage">Porcentagem de Ganho</option>
      <option value="description">Descri√ß√£o</option>
    </select>

    <input
      [formControl]="filter.searchTerm"
      type="text"
      placeholder="Digite o termo de busca..."
      class="search-input"
    />

    <!-- Bot√£o de Remover Filtro -->
    <button (click)="removeFilter(i)" class="remove-filter-button">X</button>
  </div>

  <!-- Bot√£o para Adicionar Novo Filtro -->
  <button (click)="addFilter()" class="add-filter-button">Adicionar Filtro</button>
</div>

<!-- Se√ß√£o de Ordena√ß√£o -->
<div class="sort-container">
  <label for="sortCriteria">Ordenar por:</label>
  <select id="sortCriteria" [(ngModel)]="sortCriteria" (change)="sortProducts()">
    <option value="productName">Nome</option>
    <option value="dateExpiration">Data de Validade</option>
    <option value="priceForUnity">Pre√ßo Unit√°rio</option>
    <option value="priceForUnityPercent">Pre√ßo Unit√°rio com Ganho</option>
    <option value="priceForLote">Pre√ßo por Lote</option>
    <option value="priceForLotePercent">Pre√ßo por Lote com Ganho</option>
  </select>

  <button (click)="toggleSortDirection()" class="sort-direction-button">
    {{ sortDirection === 'asc' ? '‚¨ÜÔ∏è Ascendente' : '‚¨áÔ∏è Descendente' }}
  </button>
</div>

<!-- Se√ß√£o de Exibi√ß√£o de Campos -->
<div class="field-selection">

  <!-- Bot√£o para marcar/desmarcar todos -->
  <button (click)="toggleAllFields()" class="toggle-fields-button">
    Marcar/Desmarcar Todos
  </button>

  <div *ngFor="let field of displayFields">
    <input
      type="checkbox"
      [checked]="field.selected"
      (change)="toggleField(field.key)"
    />
    <label>{{ field.label }}</label>
  </div>
</div>

<!-- Se√ß√£o de Lista de Produtos -->
<div *ngIf="filteredProducts.length > 0; else noProducts">
  <h2 class="titleproduct">Lista de Produtos</h2>

  <!-- Exibi√ß√£o de Produtos Paginados -->
  <ul class="product-list">
    <li *ngFor="let product of paginatedProducts" class="product-item"
        (mouseenter)="product.showActions = true" (mouseleave)="product.showActions = false">

      <!-- Nome do Produto -->
      <h3><strong>{{ product.productName }}</strong></h3>

      <!-- Exibi√ß√£o de Campos Din√¢micos -->
      <div *ngIf="isFieldVisible('productId')">ID: {{ product.productId }}</div>
      <div *ngIf="isFieldVisible('quantity')">Quantidade: {{ product.quantity }}</div>
      <div *ngIf="isFieldVisible('numberLote')">N√∫mero do Lote: {{ product.numberLote }}</div>
      <div *ngIf="isFieldVisible('productType')">Tipo: {{ product.productType }}</div>
      <div *ngIf="isFieldVisible('dateExpiration')">
        Data de Validade: {{ product.dateExpiration | date:'dd/MM/yyyy' }}
      </div>
      <div *ngIf="isFieldVisible('priceForUnity')">
        Pre√ßo Unit√°rio: R${{ product.priceForUnity | number:'1.2-2' }}
      </div>
      <div *ngIf="isFieldVisible('priceForUnityPercent')">
        Pre√ßo Unit√°rio com Ganho: R${{ product.priceForUnityPercent | number:'1.2-2' }}
      </div>
      <div *ngIf="isFieldVisible('priceForLote')">
        Pre√ßo por Lote: R${{ product.priceForLote | number:'1.2-2' }}
      </div>
      <div *ngIf="isFieldVisible('priceForLotePercent')">
        Pre√ßo por Lote com Ganho: R${{ product.priceForLotePercent | number:'1.2-2' }}
      </div>
      <div *ngIf="isFieldVisible('gainPercentage')">
        Porcentagem de Ganho: {{ product.gainPercentage }}%
      </div>
      <div *ngIf="isFieldVisible('description')">Descri√ß√£o: {{ product.description }}</div>

      <div *ngIf="product.promotion?.status === 'ACTIVE'">
        <strong>Promo√ß√£o:</strong>
        {{ product.promotion?.promotionDescription || 'Sem promo√ß√£o' }}
        ({{ product.promotion?.discountPercentage }}% OFF)
      </div>

      <!-- A√ß√µes de Produto -->
      <div class="action-buttons" *ngIf="product.showActions">
        <button class="delete-button" (click)="confirmDelete(product.productId)">X</button>
        <button class="edit-button" (click)="openAlterDialog(product)">üõ†Ô∏è</button>
        <button class="edit-button" (click)="openEditDialog(product)">‚úèÔ∏è</button>
      </div>

    </li>
  </ul>

  <!-- Navega√ß√£o de Pagina√ß√£o -->
  <div class="pagination">
    <button *ngFor="let page of [].constructor(totalPages()); let i = index"
            [class.active]="i + 1 === currentPage"
            (click)="changePage(i + 1)">
      {{ i + 1 }}
    </button>
  </div>
</div>

<!-- Caso n√£o haja produtos -->
<ng-template #noProducts>
  <p>Nenhum produto dispon√≠vel no momento.</p>
</ng-template>
